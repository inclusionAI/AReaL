name: areal-test-skypilot

resources:
  accelerators: A100:2
  autostop:
    idle_minutes: 10
    down: true
  cpus: 8+
  memory: 32GB+
  disk_size: 256GB
  image_id: docker:ghcr.io/inclusionai/areal-runtime:v0.3.4

num_nodes: 1

file_mounts:
  /storage: # Should be consistent with the storage paths set in gsm8k_grpo_ray.yaml
    source: s3://my-bucket/  # or gs://, https://<azure_storage_account>.blob.core.windows.net/<container>, r2://, cos://<region>/<bucket>, oci://<bucket_name>
    mode: MOUNT  # MOUNT or COPY or MOUNT_CACHED. Defaults to MOUNT. Optional.

workdir: .

run: |
  python3 -m areal.launcher.local examples/math/gsm8k_grpo.py \
    --config examples/math/gsm8k_grpo.yaml \
    experiment_name=gsm8k-grpo \
    trial_name=trial0 \
    cluster.n_nodes=1 \
    cluster.n_gpus_per_node=$SKYPILOT_NUM_GPUS_PER_NODE \
    allocation_mode=sglang.d1+d1 \
    train_dataset.batch_size=4 \
    actor.mb_spec.max_tokens_per_mb=4096
